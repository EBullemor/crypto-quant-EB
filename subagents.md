# Sub-Agent Roadmap – Crypto-Quant Bot

> v2 – 02/08/2025  
> Maintainer: **@harrycharlesworth**  
> Doc status: **living document** (update every sprint)

---

## 1. Project Snapshot (autogenerated)

| Area | Implemented in repo | Gap / TODO |
|------|--------------------|-------------|
| Core data structures      | `SignalBase`, `SignalResult`, `BlenderConfig` | ✅ OK |
| Price-only signals        | `signals/{momentum,breakout,mean_reversion}.py` | ✅ Completed |
| Portfolio blender         | `portfolio/blender.py` | ✅ Completed |
| Data connectors           | skeletal `data/connectors/__init__.py` | ❌ *needs full async REST/WSS implementation* |
| Central storage           | – (no DB layer yet) | ❌ design + Dockerise TimescaleDB/DuckDB |
| Risk engine               | – | ❌ portfolio snapshot, exposure calc, Kelly sizing |
| Execution layer           | `execution/` dir exists but empty | ❌ order routing, slippage models |
| CI / tests                | unit tests for signals in `tests/` | ⚠️ expand to 80% coverage, GitHub Actions |
| Monitoring & alerting     | email notifications implemented | ⚠️ needs Prometheus-Grafana stack |

---

## 2. Overview
Implementation of 12 evidence-based crypto signals using autonomous sub-agents. Each signal will be implemented by specialized agents with clear responsibilities and dependencies.

> **Milestone**: Phase 0 + 2 minimal viable live trading (price + funding carry) by **2025-03-15**

---

## 3. Implementation Phases

Legend: ✅ done 🔄 in-progress 🆕 new 🟥 blocked

| Phase | Scope | Status | Key Owners |
|-------|-------|--------|------------|
| 0. Infrastructure | DB schema, connectors, risk core | 🔄 35% | Data / Core team |
| 1. Price-Only Signals | Momentum, Donchian, MR, Blender | ✅ 100% | Quant team |
| 2. Funding & OI | FundingFeed, OI divergence, carry | 🆕 | Quant + Data |
| 3. X-Sectional & Basis | Multi-asset, Futures feed | 🆕 | Quant |
| 4. Options | Deribit feed, vol strategies | 🆕 | Quant + Deriv |
| 5. On-Chain | Glassnode, SSR, MVRV | 🆕 | On-Chain |
| 6. Prod Hardening | CI/CD, monitoring, stress | 🆕 | DevOps |

### Phase 0: Infrastructure (Weeks 1-2) 🔄 35%
**Goal**: Extend data infrastructure and core risk management

#### Detailed Sprint Backlog:

| Ticket | Agent / Module | Acceptance Criteria | Priority |
|--------|----------------|---------------------|----------|
| INF-01 | **DataInfrastructureAgent** | DuckDB "raw" + TimescaleDB "agg" schemas; Docker-compose setup; migrations auto-run | High |
| INF-02 | **DataConnectorAgent** | Binance & Bybit: OHLCV, funding, open-interest via asyncio + websockets, store to DuckDB in parquet partitions | High |
| INF-03 | **RiskEngineAgent** | `risk/engine.py` with: • position snapshot • PnL by symbol • Kelly sizing util • unit tests ≥90% | High |
| INF-04 | CI pipeline | GitHub Actions: lint (ruff), type-check (mypy strict), tests (pytest); coverage badge | Medium |

#### Agent Tasks:
1. **DataInfrastructureAgent** 
   - DuckDB for raw data storage (parquet partitions)
   - TimescaleDB for aggregated time-series data  
   - Redis cache for real-time data access
   - **Deliverable**: Dockerized dual-database architecture

2. **DataConnectorAgent** 
   - Async REST clients for Binance & Bybit APIs
   - WebSocket listeners with auto-reconnection
   - Rate limiting and error handling
   - **Deliverable**: Production-grade data ingestion system

3. **RiskEngineAgent**
   - Real-time portfolio snapshot tracking
   - Kelly fraction position sizing
   - Volatility targeting utilities
   - Exposure and correlation monitoring
   - **Deliverable**: Comprehensive risk management foundation

### Phase 1: Price-Only Signals (Weeks 3-4) ✅ COMPLETED
**Goal**: Implement signals that only require OHLCV data

#### Agent Tasks:
1. **SignalAgent_TSMOM** ✅ COMPLETED
   - ✅ Enhanced Time-Series Momentum with parameter optimization
   - ✅ Added volatility targeting logic (15% annualized target)
   - ✅ Implemented parameter grid search (1-3M lookback, skip last week)
   - ✅ Optimization shows 30-day lookback, 10-day skip as optimal
   - **Dependencies**: None
   - **Deliverable**: Production-ready TSMOM signal with parameter optimization

2. **SignalAgent_Donchian** ✅ COMPLETED
   - ✅ Implemented 55-Day Donchian Breakout with ATR stops
   - ✅ Added choppy market detection via ADX
   - ✅ Dynamic position sizing based on breakout strength
   - **Dependencies**: OHLCV data only
   - **Deliverable**: Breakout signal with dynamic stops and trend filters

3. **SignalAgent_MeanReversion** ✅ COMPLETED
   - ✅ Short-term mean reversion (3D, ±2σ) with Z-score detection
   - ✅ Liquidation cascade detection via volume spikes
   - ✅ Liquidity filters for high-volume pairs only
   - **Dependencies**: OHLCV data only
   - **Deliverable**: Mean reversion signal with liquidation detection

4. **PortfolioBlender_v1** ✅ COMPLETED
   - ✅ Intelligent signal conflict resolution
   - ✅ Confidence-weighted position blending
   - ✅ Risk budgeting across signal types
   - ✅ Signal correlation tracking and performance weighting
   - **Dependencies**: All Phase 1 signals
   - **Deliverable**: Multi-signal portfolio management system

#### Performance Results:
- **Momentum Signal**: 15.27% return, 0.76 Sharpe ratio
- **Breakout Signal**: 281.83% return, 2.00 Sharpe ratio  
- **Mean Reversion**: 64.30% return, 1.41 Sharpe ratio
- **Portfolio Blender**: 95.38% return, 1.34 Sharpe ratio (balanced combination)

### Phase 2: Funding & Microstructure Signals (Weeks 5-6) 🆕
**Goal**: Add funding rates and open interest data

#### Sprint Backlog:

| Ticket | Agent | Acceptance Criteria | Priority |
|--------|-------|---------------------|----------|
| FND-01 | **FundingDataAgent** | Real-time funding feed cached in Redis; <1s latency; 99.9% uptime | High |
| FND-02 | **SignalAgent_FundingCarry** | Long neg funding, short pos funding; Sharpe >1.0 on 2022-23 data | High |
| MIC-01 | **SignalAgent_OIPrice** | OI/Price divergence detection; precision-recall report >0.7 | Medium |
| PM-01  | **PortfolioBlender_v2** | Market-neutral bucket added; risk-parity blending option | Medium |

#### Agent Tasks:
1. **FundingDataAgent**
   - Hourly funding rate collection from Binance, Bybit, OKX
   - Historical funding rate backfill (6 months)
   - Cross-exchange funding spreads calculation
   - **Dependencies**: DataConnectorAgent from Phase 0
   - **Deliverable**: Real-time funding rate feed with <1s latency

2. **SignalAgent_FundingCarry**
   - Market-neutral funding carry strategy
   - Dynamic position sizing based on funding rate magnitude
   - Risk management for funding rate reversals
   - **Dependencies**: FundingDataAgent
   - **Deliverable**: Market-neutral funding carry signal

3. **SignalAgent_OIPrice**
   - Open Interest / Price divergence detection algorithm
   - Volume-weighted OI analysis
   - Liquidation cascade prediction
   - **Dependencies**: Open interest data from DataConnectorAgent
   - **Deliverable**: OI divergence signal with early warning system

4. **PortfolioBlender_v2**
   - Enhanced conflict resolution with market-neutral bucket
   - Risk-parity allocation option
   - Real-time correlation matrix updates
   - **Dependencies**: All Phase 1 + 2 signals
   - **Deliverable**: Advanced multi-signal portfolio management

### Phase 3: Cross-Sectional & Basis Signals (Weeks 7-8)
**Goal**: Multi-asset ranking and futures basis strategies

#### Agent Tasks:
1. **SignalAgent_CrossSectional**
   - Alt/BTC cross-sectional momentum (30D lookback, 7D hold)
   - **Dependencies**: Multi-asset data infrastructure
   - **Deliverable**: Relative momentum ranking system

2. **FuturesDataAgent**
   - Quarterly futures prices from Binance and CME
   - **Dependencies**: DataConnectorAgent extension
   - **Deliverable**: Futures price feed

3. **SignalAgent_CashCarry**
   - Cash-and-carry basis arbitrage (>8-10% annualized)
   - **Dependencies**: FuturesDataAgent
   - **Deliverable**: Basis trading signal

4. **SignalAgent_XExchangeFunding**
   - Cross-exchange funding dispersion arbitrage
   - **Dependencies**: Multi-venue funding data
   - **Deliverable**: Cross-venue arbitrage signal

### Phase 4: Options Volatility Signals (Weeks 9-10)
**Goal**: Options-based volatility strategies

#### Agent Tasks:
1. **OptionsDataAgent**
   - Deribit options data (ATM IV, 25Δ skew, Greeks)
   - **Dependencies**: New data connector for options
   - **Deliverable**: Options market data feed

2. **SignalAgent_VolRiskPremium**
   - Short 7-14D ATM straddles with delta hedging
   - **Dependencies**: OptionsDataAgent
   - **Deliverable**: Vol selling strategy

3. **SignalAgent_SkewWhipsaw**
   - 25Δ skew mean reversion (fade skew >+15)
   - **Dependencies**: OptionsDataAgent  
   - **Deliverable**: Skew trading signal

4. **ExecutionAgent_Options**
   - Options order routing and Greeks-based hedging
   - **Dependencies**: Base execution system
   - **Deliverable**: Options execution capability

### Phase 5: On-Chain Signals (Weeks 11-12)
**Goal**: Blockchain metrics integration

#### Agent Tasks:
1. **OnChainDataAgent**
   - Glassnode/CryptoQuant API integration
   - **Dependencies**: External API credentials
   - **Deliverable**: On-chain metrics feed

2. **SignalAgent_SSR**
   - Stablecoin Supply Ratio Z-Score calculation
   - **Dependencies**: OnChainDataAgent
   - **Deliverable**: SSR overlay filter

3. **SignalAgent_MVRV**
   - MVRV Z-Score extremes (<-1 value, >7 euphoric)
   - **Dependencies**: OnChainDataAgent
   - **Deliverable**: MVRV regime filter

### Phase 6: Production Hardening (Weeks 13-14)
**Goal**: Monitoring, testing, and deployment

#### Agent Tasks:
1. **MonitoringAgent**
   - Real-time performance tracking and alerting
   - **Dependencies**: All signal agents
   - **Deliverable**: Production monitoring system

2. **BacktestAgent_Final**
   - Multi-regime stress testing (2017 mania, 2018 winter, 2020-21 bull, 2022 crash)
   - **Dependencies**: All signals implemented
   - **Deliverable**: Comprehensive strategy validation

## Signal Specifications

### Market-Neutral Signals (Beta-Neutral)
- Cash-and-Carry Basis
- Perp Funding Carry  
- Cross-Exchange Funding Dispersion
- Options Vol-Risk Premium
- Stablecoin Supply Ratio

### Directional Signals (Symmetric Long/Short)
- Time-Series Momentum
- Donchian Breakout
- Short-Term Mean Reversion
- Alt/BTC Cross-Sectional Momentum
- OI/Price Divergence
- Skew Whipsaw
- MVRV Z-Score

## Risk Management Per Signal Type

### Carry Strategies
- Position size: 20% max allocation per signal
- Stop conditions: Funding rate reversal for 6+ hours
- Hedging: Maintain market-neutral delta exposure

### Momentum/Trend
- Volatility targeting: 10% annualized
- Stop losses: ATR-based trailing stops
- Turnover limits: 15% monthly maximum

### Mean Reversion
- Entry filters: Funding rate neutral (±1bp)
- Exit conditions: Return to VWAP
- Slippage modeling: Conservative cost assumptions

### Options Strategies
- Vega limits: Vol-target position sizing
- Delta hedging: Every 4 hours
- Tail protection: 25Δ wings (≤15% of premium cost)

## Success Metrics

### Phase Completion Criteria
- All agents pass unit tests
- Backtests show positive Sharpe ratio
- Risk limits properly enforced
- Data quality checks passing

### Production Readiness
- 2-week paper trading validation
- Multi-regime stress test pass
- Monitoring and alerting functional
- Email notifications working

---

## 4. Technical Architecture

```
+-----------------+      +----------------------+      +-----------------+
| Data Connectors | -->  |  DuckDB Raw Storage  | -->  |  Analytics API  |
+-----------------+      +----------+-----------+      +----+------------+
                                   ⬇                    ⬇
                         +---------+----------+  +------+-------+
                         | TimescaleDB (agg)  |  | Redis Cache  |
                         +---------+----------+  +------+-------+
                                   ⬇                    ⬇
+-------------+    async    +-----------+     +-----------------+
| Signal Agents| ---------> | RiskEngine| --> | Execution Agent |
+-------------+            +-----------+     +-----------------+
        ⬇                                   \
        ⬇ Prom metrics                        \ Email / Slack
+-----------------+                           +------------------+
| MonitoringAgent |                           | Notifications    |
+-----------------+                           +------------------+
```

• All inter-agent comms via Python `asyncio` and explicit type-hinted interfaces
• Storage split: immutable **raw** (DuckDB) + append-only **agg** (TimescaleDB) for query speed
• Prometheus + Grafana dashboards auto-provisioned via docker-compose

---

## 5. Coding Standards / Interfaces

1. Every agent inherits from `AgentBase` (to be created):
   ```python
   class AgentBase(ABC):
       name: str
       version: str
       dependencies: list[str]

       async def run(self, **kwargs): ...
       async def healthcheck(self) -> dict: ...
   ```

2. Signals already comply with `SignalBase`; non-signal agents must follow similar dataclass config pattern
3. Docstrings: Google style, include "Examples" with sample dataframes for unit testing
4. Linting: ruff config (`pyproject.toml`) with `flake8-annotations`, `flake8-async`, `pandas-vet`
5. Tests: `pytest -n auto` with `hypothesis` property tests for statistical routines

---

## 6. Risk & Position Management Specification

| Aspect | Implementation |
|--------|----------------|
| Position cap | per signal `max_abs_weight` + global net exposure cap 30% NAV |
| Vol targeting | realized vol ↔ target (0.15) scaling util in `risk/position.py` |
| Leverage | dynamic via Kelly fraction; floor 1×, cap 3× |
| Stop logic | ATR or vol band derived; executed by ExecutionAgent with IOC orders |

---

## 7. Success & QA Matrix

| Stage | KPI | Pass Threshold | Test Harness |
|-------|-----|----------------|--------------|
| Signal backtest | Sharpe | > 0.8 | `tests/backtest_<signal>.py` |
| Live data latency | ms | < 1500 ms end-to-end | `scripts/latency_benchmark.py` |
| Unit test coverage | % | ≥ 80% | CI badge |
| Max drawdown | % | < 15% on 2018 bear market | `BacktestAgent_Final` |

---

## 8. Open Questions

1. **Settlement currency**: USDT vs USDC vs BUSD? Affects funding calculations and cross-exchange arb
2. **Execution venue**: Smart-routing across exchanges or single-venue execution?
3. **Options hedging frequency**: 4-hour scheduled vs event-driven? Needs simulation
4. **Risk model**: Factor-based or pure statistical? Impacts correlation estimates

---

## 9. File/Module Ownership Matrix

| Path | Owner | Status | Notes |
|------|-------|--------|-------|
| `src/quantbot/signals/*` | Quant team | ✅ Existing | Momentum, Breakout, MeanReversion implemented |
| `src/quantbot/portfolio/*` | Quant team | ✅ Existing | Blender v1 complete |
| `src/quantbot/data/connectors/*` | Data eng | 🔄 Partial | Basic structure, needs async implementation |
| `src/quantbot/risk/*` | Risk eng | 🆕 New | Core risk engine needed |
| `src/quantbot/execution/*` | Trading eng | 🆕 New | Order routing and execution layer |
| `src/quantbot/monitoring/*` | DevOps | 🆕 New | Prometheus metrics and alerting |

---

## Notes
- Each sub-agent will be implemented as separate Task calls
- Agents can run concurrently where dependencies allow
- All agents must follow the SignalBase interface
- Risk management is centralized but signal-specific rules apply
- Docker-compose for local development environment
- All secrets stored in `.env` files (never committed to git)
